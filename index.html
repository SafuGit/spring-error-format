<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spring Error Formatter</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.23/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles/style.css">
</head>
<body>
  <header>
    <div class="navbar bg-base-100">
      <div class="navbar-start">
      </div>
      <div class="navbar-center">
        <a class="btn btn-ghost text-2xl">Spring Error Formatter</a>
      </div>
      <div class="navbar-end">
      </div>
    </div>
  </header>
  <main>
    <div class="response-container">
      <div class="card-container w-1/2">
        <div class="card bg-neutral text-neutral-content">
          <div class="card-body items-center text-center">
            <h2 class="card-title">Response</h2>
            <p id="response-box">Lorem ipsum dolor sit amet consectetur adipisicing elit. Omnis vel non eos nostrum, ex soluta sint pariatur reiciendis natus ut sit ratione aliquam hic inventore unde quasi quod dignissimos itaque ducimus et expedita veniam maxime labore. Et iste excepturi dolorem nihil quam consequatur perferendis unde. Qui dolores magnam ipsum animi!</p>
          </div>
        </div>
      </div> 
    </div>
    <div class="input-container">
      <div>
        <textarea class="textarea textarea-primary" id="error-box" placeholder="ErrorBox"></textarea>
        <div>
          <button class="btn btn-info" onclick="getText()">Submit</button>
          <button class="btn btn-error">Reset</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    let stackTrace = "";

    function getText() {
      var errorTextElem = document.getElementById("error-box");
      var errorText = errorTextElem.value;
      if (errorText == null || errorText.length == 0) {
        console.log(null);
      } else {
        // console.log(errorText);
        format(errorText);
      }
    }

    function format(text) {
      const messageRegex = /^.*?:(.*?)(?=\n)/g; 
      const stackTraceRegex = /at .+/g; 

      const messageMatches = [...text.matchAll(messageRegex)]; 
      const stackTraceMatch = text.match(stackTraceRegex);
  
      var message = "";
      messageMatches.forEach(match => {
        for (let i = 1; i < match.length; i++) {  // Start from 1 to skip the whole match
          console.log(match);
          message += `${match[i].trim()} \n`;
        }
      });
      console.log(message);
      stackTrace = stackTraceMatch ? stackTraceMatch.join('\n') : "No stack trace available.";

      // Display the message and stack trace
      document.getElementById("response-box").textContent = message;
      // document.getElementById("stack-trace-box").textContent = stackTrace;
    }
  </script>

  <!-- <script src="./scripts/format.js"></script> -->
</body>
</html>